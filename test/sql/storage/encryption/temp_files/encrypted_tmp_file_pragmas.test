# name: test/sql/storage/encryption/temp_files/encrypted_tmp_file_pragmas.test
# group: [temp_files]

require block_size 262144

statement ok
SET temp_directory='__TEST_DIR__/test_temp_dir'

statement ok
ATTACH '__TEST_DIR__/encrypted_temp_files.db' AS enc (ENCRYPTION_KEY 'asdf');

statement ok
USE enc;

# we do not encrypt temporary files at all
statement ok
PRAGMA debug_disable_temp_file_encryption;

statement ok
SET memory_limit = '8MB';

statement ok
SET enable_external_access=false

statement error
SET temp_directory='__TEST_DIR__/new_temp_dir'
----
disabled by configuration

statement error
RESET temp_directory
----
disabled by configuration

# temp files are not encrypted
statement ok
CREATE TEMPORARY TABLE tbl AS FROM range(10_000_000)

# note; you should be very careful using this
# If some tmp files are encrypted and others not
# this will lead to corrupt files
statement ok
PRAGMA debug_enable_temp_file_encryption;

# temp files are encrypted again
statement ok
CREATE TEMPORARY TABLE tbl2 AS FROM range(10_000_000)

statement ok
SELECT * FROM tbl, tbl2 LIMIT 10;
